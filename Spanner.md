# Spanner

# 摘要
Spanner是Google的可扩展的、多版本、全局分布式的、同步-复制的数据库。Spanner是 将数据在全球范围内进行分布并且可以支持 外部-一致性 分布式事务的第一个系统。这篇文章描述了 Spanner是如何设计的、它的特性集合、各种设计决策的基本原理 以及可以解决时钟不确定性问题的新的时间Api。这个Api以及其实现 是 支持 外部一致性 以及一些列特性的关键：非阻塞的读，lock-free 只读事务，原子的模式变化，贯穿Spanner的所有特性。
 
# 1 介绍
Spanner是一个可扩展的，全球分布式的数据库，设计，实现，并且部署均由Google亲自操刀。在抽象的最高层，Spanner是一个将数据分布跨越全世界不同数据中心间大量Paxos状态机Sets集群的数据库。副本被用于全局可用性和地址局部性（说人话就是：副本用于在全球范围内多个数据中心实现数据布局和访问高可用）；client自动的在副本间进行failover。Spanner自动的根据数据的数量 或者 节点的变更 在节点间对数据重新布局 并且 自动的在节点间（甚至在数据中心间）进行数据迁移来均衡负载并且对异常进行副本修复（就是根据数据的份数变化，新节点的加入，负载的变化，异常发生等等进行数据重分布）。Spanner被设计用来实现： 可以扩展到横跨数百个数据中心的数百万台节点以及万亿行的数据库。
 
应用程序通过将他们的数据复制到一个洲多个数据中心甚至横跨多个洲可以使用Spanner来实现高可用甚至是出现很大范围内的自然灾害。我们第一个用户是F1，Google一个重写的广告后端。F1将数据分布在美国国土范围内的存储了5个副本，大多数其他的应用或许可以尝试将数据分布在一个地理区域内具有相对独立故障模式的3到5个数据中心之间。这样，大多数的应用可以在高可用的基础上实现很低的业务延迟，同时在1~2个数据中心异常时仍然可以对外提供服务。

Spanner的核心聚焦在 如何管理副本横跨多数据中心的数据，同时我们也在Google现有的分布式系统基础设施上花费大量时间设计并且实现重要的数据库特性。尽管Bigtable已经非常适合Google现有的很多项目，但我们也经常会收到用户对Bigtable对有些场景难以应用的一些抱怨：`那些应用往往有复杂的模式`，或者`有些在多个数据中心拥有副本的应用需要强一致`.很多应用只能选择具有半-结构数据模型并且同步复制的Megastore，尽管其写吞吐相对而言非常差。最终，Spanner从Bigtable的带版本的key-value存储演变为 `时态多版本数据库`。数据存储在图式化的半-关系型表中；数据带有版本，每个版本是其提交时的时间戳；旧版本的数据通过可配置的垃圾-回收策略可以及时回收；并且应用程序可以从旧时间戳的数据。Spanner支持通用的事务并且提供SQL-based的查询语言。
 
作为一个全局分布的数据库系统，Spanner提供了及格有趣的特性。1） 应用自己可以细粒度的动态调整数据的副本配置。应用可以通过约束来控制哪个数据中心包含那份数据，数据中心应该离用户有多远（控制读延迟），每个副本之间的距离有多远（控制写延迟），要保证至少有多少个副本（控制持久性，可用性以及读性能）。
